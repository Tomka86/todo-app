<h2 class="mt-4">TeendÅ‘k</h2>

<!-- ğŸ” KeresÅ‘mezÅ‘ -->
<div class="mb-3">
  <input
    type="text"
    class="form-control"
    placeholder="KeresÃ©s a teendÅ‘k kÃ¶zÃ¶tt..."
    [(ngModel)]="searchTerm"
  />
</div>

<!-- ğŸ“Š RendezÃ©s Ã©s gombok -->
<div class="mb-3 d-flex flex-wrap gap-2 align-items-center">
  <select class="form-select w-auto" [(ngModel)]="sortBy" title="RendezÃ©s">
    <option value="title">ğŸ”  CÃ­m szerint</option>
    <option value="completed">âœ… ElvÃ©gzettsÃ©g szerint</option>
  </select>

  <button
    class="btn btn-outline-secondary"
    (click)="downloadTodos()"
    [disabled]="filteredTodos.length === 0"
  >
    ğŸ“¥ ExportÃ¡lÃ¡s JSON-kÃ©nt
  </button>

  <button
    class="btn btn-outline-danger"
    (click)="clearTodosByCategory()"
    [disabled]="filteredTodos.length === 0"
  >
    ğŸ—‘ï¸ Ã–sszes tÃ¶rlÃ©se
  </button>
</div>

<!-- ğŸ”¢ Statisztika blokk -->
<div class="alert alert-info" *ngIf="filteredTodos.length > 0">
  Ã–sszes: <strong>{{ filteredTodos.length }}</strong
  >, KÃ©sz: <strong>{{ completedCount }}</strong
  >, HÃ¡tralÃ©vÅ‘: <strong>{{ remainingCount }}</strong>
</div>

<ul class="list-group mt-2" *ngIf="filteredTodos.length > 0; else noTodos">
  <li
    class="list-group-item d-flex justify-content-between align-items-center"
    *ngFor="let todo of filteredTodos"
  >
    <div class="d-flex align-items-center">
      <input
        class="form-check-input me-2"
        type="checkbox"
        [checked]="todo.completed"
        (change)="toggleTodo(todo)"
        id="todo-{{ todo.id }}"
      />

      <ng-container *ngIf="editedTodoId === todo.id; else readMode">
        <input
          class="form-control form-control-sm"
          [(ngModel)]="todo.title"
          (blur)="saveEditedTodo()"
          (keydown.enter)="saveEditedTodo()"
          autofocus
        />
      </ng-container>

      <ng-template #readMode>
        <label
          class="form-check-label me-3"
          [for]="'todo-' + todo.id"
          [class.text-decoration-line-through]="todo.completed"
        >
          {{ todo.title }}
        </label>
      </ng-template>
    </div>

    <div class="d-flex align-items-center gap-2 flex-wrap justify-content-end">
      <span
        class="badge"
        [ngClass]="getCategoryInfo(todo.categoryId).class"
        title="KategÃ³ria"
      >
        {{ getCategoryInfo(todo.categoryId).icon }}
        {{ getCategoryInfo(todo.categoryId).name }}
      </span>

      <span class="badge bg-secondary">#{{ todo.id }}</span>

      <button
        class="btn btn-sm btn-outline-secondary"
        (click)="editTodo(todo.id)"
        title="SzerkesztÃ©s"
      >
        âœï¸
      </button>

      <button
        class="btn btn-sm btn-danger"
        (click)="deleteTodo(todo)"
        title="TÃ¶rlÃ©s"
      >
        ğŸ—‘ï¸
      </button>
    </div>
  </li>
</ul>

<ng-template #noTodos>
  <p class="text-muted mt-2">Nincs teendÅ‘ ebben a kategÃ³riÃ¡ban.</p>
</ng-template>
